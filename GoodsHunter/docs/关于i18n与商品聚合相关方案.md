最后一次提问：crawler_item表我已经有了，不需要再重申了，只需要申明增加一个product表的关联ID即可。另外关于react-i18next的配置和实现也讲一下，放到方案里。注意（内部和外部展示层都需要国际化/多语言/翻译映射的能力）。流程是：抓取多语言的原始数据，内部做商品聚合关联（会用到翻译/归一化能力：譬如都翻译成标准英文格式做匹配）。但是内部crawler_item存储的仍然是多语言的内容版本。当用户在页面选择特定语言的时候，需要动态地对语言进行匹配和转化。譬如部份item是英文的，部份是日文，部份中文。用户选择了中文，则需要在展示的时候，将内容全部映射为“中文”，可能存在部份无法映射的内容，则保留原始记录。

架构：不必完全按照这个来编写：


好的，针对你提到的需求，我会将重点放在**如何使用 `react-i18next` 实现多语言支持**、**如何在后台进行商品聚合和翻译映射**，以及**如何确保在不同语言之间的动态转换**。以下是更新后的完整架构和技术方案：

---

## 1) **架构设计（数据层、聚合层、展示层）**

### 1.1 数据层（Postgres）

你已经有了 `crawler_item` 表来存储抓取的原始数据，下面只需要在**聚合商品层**（`product` 表）做必要的改动，来确保能够关联商品，并支持多语言。

#### 1.1.1 **新增字段：`product_id`（外键）**

在 `crawler_item` 表中，新增一个字段 `product_id`，用于将抓取的数据记录关联到聚合商品。

```sql
ALTER TABLE crawler_item ADD COLUMN product_id BIGINT NULL;
```

* `product_id`：聚合商品的 ID，如果该商品是新商品（即没有匹配的聚合商品），则该字段为空。如果是已有商品，则通过 `product_id` 将其与聚合商品关联。

#### 1.1.2 **`product` 表**（聚合商品）

这个表存储的是**标准化的商品信息**，每个商品有唯一的聚合 ID。`product` 表的主要作用是去重和提供标准化数据，以便后续多语言的动态展示。

```sql
CREATE TABLE product (
    id BIGSERIAL PRIMARY KEY,
    category TEXT NOT NULL, -- 类型，手表，珠宝，包，衣服，相机，etc
    brand_name TEXT NOT NULL,             -- 标准化品牌名（英文）
    model_name TEXT NOT NULL,             -- 标准化型号名（英文）
    model_no TEXT NOT NULL,               -- 标准化型号编号（英文）
    aliases JSONB NULL,                   -- 品牌别名（包括多语言）
    
    -- 标准化字段（非动态字段）
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
```

### 1.2 聚合层（商品聚合与翻译映射）

#### 1.2.1 聚合商品的生成与更新

* **抓取后**：（抓取时不必更新/可以在抓取后单独的程序进行关联【进行解耦合】）根据品牌、型号、型号编号（`brand_name`, `model_name`, `model_no`）去查找是否已有聚合商品。如果存在，则将该商品与现有聚合商品关联；如果不存在，则创建一个新的聚合商品记录，并将抓取记录与该聚合商品关联。

#### 1.2.2 多语言翻译与归一化

* **翻译映射**：在抓取时，所有原始数据（包括品牌名、型号名等）应进行归一化，确保其存储为标准英文格式。不同语言的翻译可以通过字典或专门的翻译表（例如 `brand_translations` 和 `model_translations`）来处理。

  * 使用 `brand_translations` 表和 `model_translations` 表存储品牌和型号的翻译。

  * 这些表的字段设计如下：

    ```sql
    CREATE TABLE brand_translations (
        brand_name TEXT PRIMARY KEY,  -- 英文品牌名
        translations JSONB           -- 各种语言的别名（如：英文、中文、日文）
    );
    ```

    ```sql
    CREATE TABLE model_translations (
        model_no TEXT PRIMARY KEY,   -- 型号编号
        translations JSONB           -- 各种语言的别名（如：英文、中文、日文）
    );
    ```

  * `translations` 存储每个品牌和型号的不同语言版本，如下所示：

    ```json
    {
      "en": "Rolex",
      "zh": "劳力士",
      "ja": "ロレックス"
    }
    ```

#### 1.2.3 聚合商品和 `crawler_item` 的关联

* `crawler_item` 表和 `product` 表通过 `product_id` 关联，确保每个商品的抓取数据和聚合商品记录匹配。

---

## 2) **展示层（前端：React + react-i18next）**

### 2.1 **react-i18next 配置**

`react-i18next` 是 React 中非常流行的国际化库，能够支持动态语言切换，并处理品牌名称、型号名称等的翻译。以下是如何配置 `react-i18next` 来支持多语言。

#### 2.1.1 安装依赖

```bash
npm install react-i18next i18next i18next-browser-languagedetector i18next-http-backend
```

#### 2.1.2 `i18n.js` 配置

```js
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import Backend from 'i18next-http-backend';
import LanguageDetector from 'i18next-browser-languagedetector';

i18n
  .use(Backend)  // 后端加载翻译文件
  .use(LanguageDetector)  // 自动检测用户语言
  .use(initReactI18next)  // 连接 react-i18next
  .init({
    fallbackLng: 'en',  // 默认语言
    debug: true,
    interpolation: {
      escapeValue: false,  // 不转义
    },
    react: {
      useSuspense: false,  // 禁用 suspense（可选）
    },
  });

export default i18n;
```

#### 2.1.3 翻译文件（例如 `public/locales/en/translation.json`）

```json
{
  "brand": {
    "rolex": "Rolex",
    "seiko": "Seiko",
    "grand_seiko": "Grand Seiko"
  },
  "currency": {
    "JPY": "¥",
    "USD": "$",
    "CNY": "¥"
  },
  "app": {
    "welcome": "Welcome to our store!",
    "change_language": "Change Language"
  }
}
```

#### 2.1.4 在组件中使用翻译

```jsx
import { useTranslation } from 'react-i18next';

function ItemCard({ brand_name, price }) {
  const { t } = useTranslation();

  return (
    <div>
      <h3>{t(`brand.${brand_name.toLowerCase()}`)}</h3>
      <p>{new Intl.NumberFormat('en-US', { style: 'currency', currency: 'JPY' }).format(price)}</p>
    </div>
  );
}
```

#### 2.1.5 语言切换功能

```jsx
import { useTranslation } from 'react-i18next';

function LanguageSelector() {
  const { i18n } = useTranslation();

  const changeLanguage = (lang) => {
    i18n.changeLanguage(lang);  // 动态切换语言
  };

  return (
    <div>
      <button onClick={() => changeLanguage('en')}>English</button>
      <button onClick={() => changeLanguage('zh')}>中文</button>
      <button onClick={() => changeLanguage('ja')}>日本語</button>
    </div>
  );
}
```

### 2.2 **商品列表页（分页与筛选）**

* 展示商品信息时，前端会根据当前语言选择翻译商品的品牌名、型号名、型号编号等。

**商品列表展示**：

```jsx
function ItemList({ items }) {
  return (
    <div>
      {items.map((item) => (
        <ItemCard 
          key={item.id}
          brand_name={item.brand_name}
          model_name={item.model_name}
          model_no={item.model_no}
          price={item.price}
        />
      ))}
    </div>
  );
}
```

**分页与筛选**：使用 `React` 的状态管理（如 `useState`）来处理分页和筛选。每次筛选后，调用 API 更新数据。

---

### 2.3 **商品详情页**

商品详情页展示时，前端会展示标准化的数据，并通过 `react-i18next` 来加载品牌和型号的翻译。

```jsx
function ItemDetail({ item }) {
  const { t } = useTranslation();

  return (
    <div>
      <h1>{t(`brand.${item.brand_name.toLowerCase()}`)} - {item.model_name}</h1>
      <img src={item.image_url} alt={item.model_name} />
      <p>{t('currency.JPY')} {item.price}</p>
      <a href={item.product_url} target="_blank" rel="noopener noreferrer">{t('app.visit_product_page')}</a>
    </div>
  );
}
```

---

## 3) **商品聚合与翻译映射**

### 3.1 聚合商品的生成与更新

* 在抓取数据之后，有个单独的流程来运行关联：**标准化品牌和型号名称**，并存储到 `product` 表中。
* 将不同来源的商品记录（`crawler_item`）关联到一个唯一的聚合商品（`product`）上。
* 通过 **品牌、型号、型号编号**（`brand_name`, `model_name`, `model_no`）进行聚合，确保不同来源的商品数据归并到同一个商品条目。

### 3.2 聚合层的语言支持

* 当商品数据来自不同语言版本时，**抓取时**就进行**归一化**（标准化为英文）。
* 使用 **多语言翻译表**（`brand_translations`, `model_translations`）在展示层动态翻译品牌和型号。

### 3.3 展示层的动态映射

* 展示层使用 `react-i18next` 根据当前语言自动加载翻译并展示。
* 如果某些翻译缺失，展示层保留原始数据或使用默认值。

---

## 4) **总结**

1. **数据层**：

   * 存储原始商品数据（`crawler_item` 表）。
   * 聚合商品（`product` 表），每个商品关联多个抓取记录。
   * **品牌和型号的翻译**通过专门的翻译表（`brand_translations`, `model_translations`）管理。

2. **聚合层**：

   * 根据 `brand_name`, `model_name`, `model_no` 聚合商品数据，确保数据唯一性。
   * **翻译映射**：抓取时标准化英文，展示层动态加载不同语言的翻译。

3. **展示层**：

   * 使用 **`react-i18next`** 处理语言切换和翻译。
   * 支持 **货币格式化** 和 **商品信息展示**，并能够根据用户选择的语言展示不同的品牌与型号翻译。

这个方案将确保你能同时处理 **多语言支持**、**商品聚合**、以及 **商品信息翻译** 的需求。
